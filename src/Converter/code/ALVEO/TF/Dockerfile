FROM xilinx/vitis-ai:1.4.1.978

# Arguments
ARG CONVERTER_APP_ARG=converter.py
ARG LOG_CONFIG_ARG=logconfig.ini
ARG SCRIPT_ARG=script.sh
ARG DEVICE_ARG=ALVEO
ARG COMPILER_ARG=compiler.sh

ARG MODELS_PATH_ARG=/models
ARG LOGS_PATH_ARG=/logs/${DEVICE_ARG}
ARG OUTPUTS_PATH_ARG=/outputs/${DEVICE_ARG}
ARG DATASETS_PATH_ARG=/datasets
ARG DATALOADERS_PATH_ARG=/dataloaders

# Environmental Variables
ENV CONVERTER_APP=${CONVERTER_APP_ARG}
ENV LOG_CONFIG=${LOG_CONFIG_ARG}
ENV SCRIPT=${SCRIPT_ARG}
ENV COMPILER=${COMPILER_ARG}
ENV LOG_FILE=${LOGS_PATH_ARG}/Converter_${DEVICE_ARG}
ENV MODELS_PATH=${MODELS_PATH_ARG}
ENV LOGS_PATH=${LOGS_PATH_ARG}
ENV OUTPUTS_PATH=${OUTPUTS_PATH_ARG}
ENV DATASETS_PATH=${DATASETS_PATH_ARG}
ENV DATALOADERS_PATH=${DATALOADERS_PATH_ARG}

ENV MODEL_NAME=default_model
ENV DATASET_NAME=default_dataset
ENV TRAINED=False
ENV DATALOADER_NAME=default_dataloader.py

ENV QUANTIZATION_SAMPLES=50
ENV ARCH=U280_L

# Copy Files
COPY ${CONVERTER_APP_ARG} ${WORKING_DIR_ARG}
COPY ${LOG_CONFIG_ARG} ${WORKING_DIR_ARG}
COPY ${SCRIPT_ARG} ${WORKING_DIR_ARG}
COPY ${COMPILER_ARG} ${WORKING_DIR_ARG}

RUN chmod +x ${COMPILER_ARG}

CMD /bin/bash ${SCRIPT}